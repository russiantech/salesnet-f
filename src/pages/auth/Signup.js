import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useState, useEffect } from "react";
import { NavLink, useNavigate } from "react-router-dom"; // Use useNavigate instead of useHistory
import { AxiosUsersService } from "../../services/net/AxiosUsersService";
import { NotificationService } from "../../services/local/NotificationService";
import ResponseModal from "../../components/shared/modals/ResponseModal";
const Signup = () => {
    const navigate = useNavigate(); // Initialize useNavigate
    const [formData, setFormData] = useState({
        username: '',
        email: '',
        phone: '',
        password: '',
    });
    const [modalState, setModalState] = useState({ show: false, message: '', type: '' });
    const [isLoading, setIsLoading] = useState(false); // Loading state for the button
    useEffect(() => {
        const observer = (data) => {
            setModalState(data);
        };
        NotificationService.subscribe(observer);
        return () => {
            NotificationService.unsubscribe(observer);
        };
    }, []);
    const onSubmitForm = (evt) => {
        evt.preventDefault();
        setIsLoading(true); // Set loading state to true
        // Show loading message
        NotificationService.showDialog("Submitting form...", "primary");
        if (!formData.username || !formData.phone || !formData.email || !formData.password) {
            NotificationService.showDialog("Must provide ('username', 'phone', 'email', 'password')", "danger");
            setIsLoading(false); // Reset loading state
            return;
        }
        AxiosUsersService.signup(formData).then(res => {
            const message = res.data.full_messages && res.data.full_messages.length > 0
                ? res.data.full_messages[0]
                : res.data.message || res.data.error;
            if (res.data && res.data.success) {
                NotificationService.showDialog(message || 'You registered successfully', 'success');
                navigate('/auth/signin');
                // navigate('/user/personal'); 
            }
            else {
                NotificationService.showDialog(message || 'Unknown error occurred', 'error');
            }
        }).catch(err => {
            // Check if the error response exists
            const errorMessage = err.response?.data?.error || err.message || 'An unknown error occurred';
            NotificationService.showDialog(errorMessage, 'error');
        }).finally(() => {
            setIsLoading(false); // Reset loading state after completion
        });
    };
    const onInputChange = (key, evt) => {
        setFormData({ ...formData, [key]: evt.target.value });
    };
    // console.log(formData);
    return (_jsx(_Fragment, { children: _jsx("main", { className: "content-wrapper w-100 px-3 ps-lg-5 pe-lg-4 mx-auto", style: { "maxWidth": "1920px" }, children: _jsxs("div", { className: "d-lg-flex", children: [_jsxs("div", { className: "d-flex flex-column min-vh-100 w-100 py-4 mx-auto me-lg-5", style: { maxWidth: '416px' }, children: [_jsx("header", { className: "navbar px-0 pb-4 mt-n2 mt-sm-0 mb-2 mb-md-3 mb-lg-4", children: _jsxs(NavLink, { className: "navbar-brand pt-0", to: "/", children: [_jsx("span", { className: "d-flex flex-shrink-0 text-primary rtl-flip me-2", children: _jsx("div", { className: "flex-shrink-0 border rounded-circle", style: { width: '32px' }, children: _jsx("div", { className: "ratio ratio-1x1 rounded-circle overflow-hidden", children: _jsx("img", { src: "/assets/img/us/logos/favicon.svg", alt: "Avatar" }) }) }) }), "Salesnet"] }) }), _jsx("h1", { className: "h2 mt-auto", children: "Create an account" }), _jsxs("div", { className: "nav fs-sm mb-3 mb-lg-4", children: ["I already have an account", _jsx(NavLink, { className: "nav-link badge text-decoration-none rounded-pill p-1 ml-1 text-bg-info", to: "/auth/signin", children: "Sign in" })] }), _jsxs("div", { className: "nav fs-sm mb-4 d-lg-none", children: [_jsx("span", { className: "me-2", children: "Uncertain about creating an account?" }), _jsx(NavLink, { className: "text-decoration-none rounded-pill p-1 text-bg-info", to: "#benefits", "data-bs-toggle": "offcanvas", "aria-controls": "benefits", children: "Explore the Benefits" })] }), _jsxs("form", { className: "needs-validation", id: "signup_form", onSubmit: onSubmitForm, noValidate: true, children: [_jsxs("div", { className: "position-relative mb-4", children: [_jsx("label", { htmlFor: "username", className: "form-label", children: "Username" }), _jsx("input", { type: "text", name: "username", value: formData.username, onChange: (evt) => onInputChange('username', evt), placeholder: "enter/choose your username", className: "form-control form-control-lg", id: "username", required: true }), _jsx("div", { className: "invalid-tooltip bg-transparent py-0", children: "Must enter/choose your username!" })] }), _jsxs("div", { className: "position-relative mb-4", children: [_jsx("label", { htmlFor: "email", className: "form-label", children: "Email" }), _jsx("input", { type: "email", name: "email", value: formData.email, onChange: (evt) => onInputChange('email', evt), placeholder: "valid email address", className: "form-control form-control-lg", id: "email", required: true }), _jsx("div", { className: "invalid-tooltip bg-transparent py-0", children: "Enter a valid email address!" })] }), _jsxs("div", { className: "position-relative mb-4", children: [_jsx("label", { htmlFor: "phone", className: "form-label", children: "Phone" }), _jsx("input", { type: "tel", name: "phone", value: formData.phone, onChange: (evt) => onInputChange('phone', evt), placeholder: "active phone number", className: "form-control form-control-lg", id: "phone", required: true }), _jsx("div", { className: "invalid-tooltip bg-transparent py-0", children: "Enter a valid phone number!" })] }), _jsxs("div", { className: "mb-4", children: [_jsx("label", { htmlFor: "password", className: "form-label", children: "Password" }), _jsxs("div", { className: "password-toggle", children: [_jsx("input", { type: "password", name: "password", value: formData.password, onChange: (evt) => onInputChange('password', evt), className: "form-control form-control-lg", id: "password", minLength: 4, placeholder: "Minimum 4 characters", required: true }), _jsx("div", { className: "invalid-tooltip bg-transparent py-0", children: "Password does not meet the required criteria!" }), _jsx("label", { className: "password-toggle-button fs-lg", "aria-label": "Show/hide password", children: _jsx("input", { type: "checkbox", className: "btn-check" }) })] })] }), _jsx("div", { className: "d-flex flex-column gap-2 mb-4", children: _jsxs("div", { className: "form-check", children: [_jsx("input", { type: "checkbox", defaultChecked: true, className: "form-check-input", id: "privacy", required: true }), _jsxs("label", { htmlFor: "privacy", className: "form-check-label", children: ["I have read and accept the ", _jsx(NavLink, { className: "text-dark-emphasis", to: "#!", children: " Privacy Policy" })] })] }) }), _jsx(ResponseModal, { show: modalState.show, message: modalState.message, type: modalState.type }), _jsx("button", { type: "submit", className: `btn btn-lg bg-dark text-white w-100 ${isLoading ? 'disabled' : ''}`, disabled: isLoading, children: isLoading ? (
                                        // <span className="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                        _jsx("div", { className: "spinner-grow spinner-grow-sm", role: "status", children: _jsx("span", { className: "visually-hidden", children: "Loading..." }) })) : ('Sign up Now.') })] }), _jsxs("div", { className: "d-flex align-items-center my-4", children: [_jsx("hr", { className: "w-100 m-0" }), _jsx("span", { className: "text-body-emphasis fw-medium text-nowrap mx-4", children: "or continue with" }), _jsx("hr", { className: "w-100 m-0" })] }), _jsxs("div", { className: "d-flex flex-column flex-sm-row gap-3 pb-4 mb-3 mb-lg-4", children: [_jsxs("button", { type: "button", className: "btn btn-lg btn-outline-secondary w-100 px-2", children: [_jsx("i", { className: "fi-google ms-1 me-1" }), "Google"] }), _jsxs("button", { type: "button", className: "btn disabled btn-lg btn-outline-secondary w-100 px-2", children: [_jsx("i", { className: "fi-facebook ms-1 me-1" }), "Facebook"] }), _jsxs("button", { type: "button", className: "btn disabled btn-lg btn-outline-secondary w-100 px-2", children: [_jsx("i", { className: "fi-apple ms-1 me-1" }), "Apple"] })] })] }), _jsxs("div", { className: "offcanvas-lg offcanvas-end w-100 py-lg-4 ms-auto", id: "benefits", style: { maxWidth: '1034px' }, children: [_jsxs("div", { className: "offcanvas-header justify-content-end position-relative z-2 p-3", children: [_jsx("button", { type: "button", className: "btn btn-icon btn-outline-dark text-dark border-dark bg-transparent rounded-circle d-none-dark", "data-bs-dismiss": "offcanvas", "data-bs-target": "#benefits", "aria-label": "Close", children: _jsx("i", { className: "fi-close fs-lg" }) }), _jsx("button", { type: "button", className: "btn btn-icon btn-outline-dark text-light border-light bg-transparent rounded-circle d-none d-inline-flex-dark", "data-bs-dismiss": "offcanvas", "data-bs-target": "#benefits", "aria-label": "Close", children: _jsx("i", { className: "fi-close fs-lg" }) })] }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-info-subtle d-lg-none" }), _jsxs("div", { className: "offcanvas-body position-relative z-2 d-lg-flex flex-column align-items-center justify-content-center h-100 pt-2 px-3 p-lg-0", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-info-subtle rounded-5 d-none d-lg-block" }), _jsxs("div", { className: "position-relative z-2 w-100 text-center px-md-2 p-lg-5", children: [_jsx("h2", { className: "h4 pb-3", children: "Salesnet account benefits" }), _jsx("div", { className: "mx-auto", style: { maxWidth: '790px' }, children: _jsxs("div", { className: "row row-cols-1 row-cols-sm-2 g-3 g-md-4 g-lg-3 g-xl-4", children: [_jsx("div", { className: "col", children: _jsxs("div", { className: "card h-100 bg-transparent border-0", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white border border-white border-opacity-75 rounded-4 d-none-dark", style: { "FnAspectRatio": '.3' } }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white border rounded-4 d-none d-block-dark", style: { "FnAspectRatio": '.05' } }), _jsxs("div", { className: "card-body position-relative z-2", children: [_jsxs("div", { className: "d-inline-flex position-relative text-info p-3", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white rounded-pill d-none-dark" }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-body-secondary rounded-pill d-none d-block-dark" }), _jsx("i", { className: "fi-mail position-relative z-2 fs-4 m-1" })] }), _jsx("h3", { className: "h6 pt-2 my-2", children: "Get discount updates" })] })] }) }), _jsx("div", { className: "col", children: _jsxs("div", { className: "card h-100 bg-transparent border-0", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white border border-white border-opacity-75 rounded-4 d-none-dark", style: { "FnAspectRatio": '.3' } }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white border rounded-4 d-none d-block-dark", style: { "FnAspectRatio": '.05' } }), _jsxs("div", { className: "card-body position-relative z-2", children: [_jsxs("div", { className: "d-inline-flex position-relative text-info p-3", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white rounded-pill d-none-dark" }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-body-secondary rounded-pill d-none d-block-dark" }), _jsx("i", { className: "fi-settings position-relative z-2 fs-4 m-1" })] }), _jsx("h3", { className: "h6 pt-2 my-2", children: "Manage your subscriptions." })] })] }) }), _jsx("div", { className: "col", children: _jsxs("div", { className: "card h-100 bg-transparent border-0", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white border border-white border-opacity-75 rounded-4 d-none-dark", style: { "FnAspectRatio": '.3' } }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white border rounded-4 d-none d-block-dark", style: { "FnAspectRatio": '.05' } }), _jsxs("div", { className: "card-body position-relative z-2", children: [_jsxs("div", { className: "d-inline-flex position-relative text-info p-3", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white rounded-pill d-none-dark" }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-body-secondary rounded-pill d-none d-block-dark" }), _jsx("i", { className: "fi-gift position-relative z-2 fs-4 m-1" })] }), _jsx("h3", { className: "h6 pt-2 my-2", children: "Subscribe to a service on the go." })] })] }) }), _jsx("div", { className: "col", children: _jsxs("div", { className: "card h-100 bg-transparent border-0", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white border border-white border-opacity-75 rounded-4 d-none-dark", style: { "FnAspectRatio": '.3' } }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white border rounded-4 d-none d-block-dark", style: { "FnAspectRatio": '.05' } }), _jsxs("div", { className: "card-body position-relative z-2", children: [_jsxs("div", { className: "d-inline-flex position-relative text-info p-3", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white rounded-pill d-none-dark" }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-body-secondary rounded-pill d-none d-block-dark" }), _jsx("i", { className: "fi-percent position-relative z-2 fs-4 m-1" })] }), _jsx("h3", { className: "h6 pt-2 my-2", children: "Monitor and track usage." })] })] }) }), _jsx("div", { className: "col", children: _jsxs("div", { className: "card h-100 bg-transparent border-0", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white border border-white border-opacity-75 rounded-4 d-none-dark", style: { "FnAspectRatio": '.3' } }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white border rounded-4 d-none d-block-dark", style: { "FnAspectRatio": '.05' } }), _jsxs("div", { className: "card-body position-relative z-2", children: [_jsxs("div", { className: "d-inline-flex position-relative text-info p-3", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white rounded-pill d-none-dark" }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-body-secondary rounded-pill d-none d-block-dark" }), _jsx("i", { className: "fi-heart position-relative z-2 fs-4 m-1" })] }), _jsx("h3", { className: "h6 pt-2 my-2", children: "Get support as soon as possible." })] })] }) }), _jsx("div", { className: "col", children: _jsxs("div", { className: "card h-100 bg-transparent border-0", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white border border-white border-opacity-75 rounded-4 d-none-dark", style: { "FnAspectRatio": '.3' } }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white border rounded-4 d-none d-block-dark", style: { "FnAspectRatio": '.05' } }), _jsxs("div", { className: "card-body position-relative z-2", children: [_jsxs("div", { className: "d-inline-flex position-relative text-info p-3", children: [_jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-white rounded-pill d-none-dark" }), _jsx("span", { className: "position-absolute top-0 start-0 w-100 h-100 bg-body-secondary rounded-pill d-none d-block-dark" }), _jsx("i", { className: "fi-pie-chart position-relative z-2 fs-4 m-1" })] }), _jsx("h3", { className: "h6 pt-2 my-2", children: "Easy access to services." })] })] }) })] }) })] })] })] })] }) }) }));
};
export default Signup;
